# 황금발판 랜덤 효과 시스템

## 개요
황금발판은 윷놀이 게임에서 특별한 보너스를 제공하는 발판입니다. 말이 황금발판에 도착하면 **4가지 효과 중 하나를 랜덤으로** 획득합니다.

## 황금발판 효과 종류

### 1. 한 번 더 던지기 ✅
- 즉시 추가로 윷을 던질 수 있는 기회 획득
- 턴이 유지되며 바로 다시 던질 수 있음

### 2. 보호막 효과 🛡️
- 다음에 적 말에게 잡힐 상황이 와도 한 번 보호받음
- 시각적으로 말 주변에 반투명 파란색 구체가 회전하며 표시됨
- 보호막 사용 후 자동으로 제거됨

### 3. 다시 던지기 기회 🔄
- 다음 윷 던지기 결과가 마음에 안 들면 한 번 다시 던질 수 있음
- 윷을 던진 후 "다시 던지기" 또는 "사용 안 함" 버튼이 표시됨
- 플레이어가 선택할 수 있음

### 4. 낙 방지 아이템 🍀
- 다음 윷 던지기에서 낙이 나오면 자동으로 다시 던지기
- 낙의 불운을 한 번 방지할 수 있음
- 사용 후 자동으로 제거됨

## 주요 기능

### 1. 황금발판 선택 및 표시
- 게임 시작 시 랜덤으로 황금발판이 선택됩니다 (0번 시작 위치 제외)
- 황금발판은 황금색 머티리얼로 표시됩니다
- 말이 황금발판에 도착하면 새로운 랜덤 위치로 황금발판이 이동합니다

### 2. 선택 가능한 황금발판 표시
- 윷을 던진 후 이동 가능한 발판 중 황금발판이 포함되어 있으면:
  - 황금발판은 황금색을 유지합니다
  - 황금발판 위에 빨간색 원판이 표시됩니다 (선택 가능 표시)
  - 빨간색 원판 사양:
    - 모양: Cylinder (동그란 원판)
    - 크기: X: 2.5, Y: 0.1, Z: 2.5
    - 위치: 발판 위 2.0 유닛
    - 색상: RGB(198, 36, 70, 255)

### 3. 황금발판 효과 (랜덤)
- 말이 황금발판에 도착하면:
  1. 4가지 효과 중 하나를 랜덤으로 선택
  2. 선택된 효과를 해당 말에게 부여
  3. 효과 이름과 함께 메시지 표시 (예: "황금 발판 효과! [보호막] 획득!")
  4. 0.5초 대기 후 새로운 랜덤 위치에 황금발판 생성
  5. 이전 황금발판은 원래 색상으로 복구

### 4. 효과 작동 방식

#### 한 번 더 던지기
- `hasExtraThrow`와 `canThrowAgain` 플래그 활성화
- 즉시 윷 던지기 버튼 활성화

#### 보호막 효과
- `hasShield[horseIndex] = true` 설정
- 말 주변에 반투명 파란색 구체 생성 (회전 애니메이션)
- 적 말이 잡으려 할 때 `IsProtectedByShield()` 체크
- 보호받으면 보호막 제거 및 메시지 표시

#### 다시 던지기 기회
- `hasRerollChance[horseIndex] = true` 설정
- 윷 던진 후 (낙이 아닐 때) "다시 던지기" 버튼 표시
- 플레이어가 선택하면 윷을 다시 던짐
- 사용 후 `hasRerollChance[horseIndex] = false`

#### 낙 방지 아이템
- `hasNakProtection[horseIndex] = true` 설정
- 윷 결과가 낙일 때 자동으로 체크
- 낙 방지 아이템이 있으면 자동으로 다시 던지기
- 사용 후 `hasNakProtection[horseIndex] = false`

---

## 구현 파일

### 1. GoldenPlatformEffect.cs (새로 추가)
황금발판 효과를 관리하는 메인 클래스

**주요 메서드:**
- `GrantRandomEffect(int horseIndex)`: 랜덤 효과 부여
- `ApplyEffect(int horseIndex, GoldenEffectType effect)`: 특정 효과 적용
- `IsProtectedByShield(int horseIndex)`: 보호막 체크
- `UseRerollChance(int horseIndex)`: 다시 던지기 사용
- `UseNakProtection(int horseIndex)`: 낙 방지 사용
- `CreateShieldVisual(int horseIndex)`: 보호막 시각 효과 생성

**효과 상태 배열:**
```csharp
public bool[] hasShield = new bool[8];           // 보호막
public bool[] hasRerollChance = new bool[8];     // 다시 던지기
public bool[] hasNakProtection = new bool[8];    // 낙 방지
```

### 2. YutGameManager.cs (수정)
황금발판 효과 매니저 통합

**추가된 부분:**
```csharp
[Header("Managers")]
public GoldenPlatformEffect goldenEffectManager;

// Start 메서드에 초기화 추가
if (goldenEffectManager == null)
{
    goldenEffectManager = GetComponent<GoldenPlatformEffect>();
    if (goldenEffectManager == null)
    {
        goldenEffectManager = gameObject.AddComponent<GoldenPlatformEffect>();
    }
    goldenEffectManager.Initialize(this);
}
```

**황금발판 도착 처리 (MoveHorseInternal):**
```csharp
// 황금 발판인지 확인 (최종 발판에서만)
if (isLastStep && platformManager != null && playerPositions[horseIndex] == platformManager.GoldenPlatformIndex)
{
    platformManager.RestorePlatformColor(platformManager.GoldenPlatformIndex);
    
    // 랜덤 효과 부여
    if (goldenEffectManager != null)
    {
        GoldenEffectType effect = goldenEffectManager.GrantRandomEffect(horseIndex);
        string effectName = GoldenPlatformEffect.GetEffectName(effect);
        
        if (resultText != null)
        {
            resultText.text = $"황금 발판 효과! [{effectName}] 획득!";
        }
    }
    
    yield return new WaitForSeconds(0.5f);
    platformManager.SelectRandomGoldenPlatform();
}
```

**보호막 체크 (적 말 잡기):**
```csharp
// 보호막으로 보호받는 말 제거
if (goldenEffectManager != null)
{
    List<int> protectedHorses = new List<int>();
    foreach (int enemyHorseIndex in enemyHorsesToCapture)
    {
        if (goldenEffectManager.IsProtectedByShield(enemyHorseIndex))
        {
            protectedHorses.Add(enemyHorseIndex);
            // 보호막 메시지 표시
        }
    }
    
    // 보호받은 말들은 잡히지 않음
    foreach (int protectedHorse in protectedHorses)
    {
        enemyHorsesToCapture.Remove(protectedHorse);
    }
}
```

### 3. YutTurnManager.cs (수정)
윷 던지기 결과 처리 시 효과 적용

**낙 방지 체크:**
```csharp
// 낙 방지 아이템 체크
if (outcome == YutOutcome.Nak && gameManager.goldenEffectManager != null)
{
    if (gameManager.goldenEffectManager.CurrentPlayerHasNakProtection())
    {
        // 낙 방지 아이템 사용
        // 다시 던지기
        gameManager.canThrowAgain = true;
        yield break;
    }
}
```

**다시 던지기 버튼 표시:**
```csharp
// 다시 던지기 기회 체크 (낙이 아닐 때만)
if (outcome != YutOutcome.Nak && gameManager.goldenEffectManager != null)
{
    if (gameManager.goldenEffectManager.CurrentPlayerHasReroll())
    {
        // 다시 던지기 버튼 표시
        yield return StartCoroutine(ShowRerollButton());
        
        if (rerollRequested)
        {
            // 다시 던지기 실행
        }
    }
}
```

**ShowRerollButton() 메서드:**
- Canvas에 "다시 던지기" 버튼 동적 생성
- "사용 안 함" 버튼도 함께 생성
- 플레이어 선택 대기
- 선택 후 버튼 제거

### 4. YutPlatformManager.cs (기존)
황금발판 시각적 표시 관리 (변경 없음)

---

## 효과 확률
모든 효과는 동일한 확률(25%)로 랜덤 선택됩니다:
- 한 번 더 던지기: 25%
- 보호막: 25%
- 다시 던지기: 25%
- 낙 방지: 25%

---

## 시각적 효과

### 황금발판
- 황금색 머티리얼 (StumpGolden)
- 선택 가능 시 빨간색 원판 표시

### 보호막
- 반투명 파란색 구체 (Color: 0.3, 0.6, 1.0, 0.3)
- 말 주변에서 회전 (30도/초)
- 크기: 2.5 x 2.5 x 2.5

### 다시 던지기 버튼
- 황금색 버튼 (Color: 1.0, 0.8, 0.2)
- 화면 중앙 하단에 표시
- "다시 던지기" / "사용 안 함" 두 개의 버튼

---

## 디버그 로그
- `[황금발판] 말 X이(가) [효과명] 효과 획득!`
- `[보호막] 말 X이(가) 보호막으로 보호받음!`
- `[다시 던지기] 플레이어가 다시 던지기 선택!`
- `[낙 방지] 낙이 나왔지만 낙 방지 아이템으로 다시 던지기!`

---

## 설정 방법
1. Unity에서 게임 실행
2. GoldenPlatformEffect 컴포넌트가 자동으로 YutGameManager에 추가됨
3. 추가 설정 불필요 (모든 효과가 스크립트로 자동 생성됨)

---

## 테스트 방법
1. 게임 시작
2. 황금발판으로 말 이동
3. 랜덤 효과 획득 메시지 확인
4. 각 효과 테스트:
   - **한 번 더 던지기**: 즉시 윷 던지기 버튼 활성화 확인
   - **보호막**: 말 주변 파란 구체 확인, 적 말에게 잡히지 않는지 확인
   - **다시 던지기**: 윷 던진 후 버튼 표시 확인, 선택 시 다시 던지기 확인
   - **낙 방지**: 낙이 나왔을 때 자동으로 다시 던지기 확인

---

## 주의사항
- 효과는 말 단위로 부여됩니다 (팀 단위 아님)
- 보호막은 한 번 사용 후 자동 제거됩니다
- 다시 던지기와 낙 방지도 한 번 사용 후 제거됩니다
- 한 번 더 던지기는 즉시 사용되며 저장되지 않습니다
- 여러 말이 각각 다른 효과를 가질 수 있습니다
